#!/bin/bash

echo "üîç Ejecutando pre-push: validaci√≥n de commits"

PATTERN='^(feat|fix|docs|style|refactor|perf|test|chore)(\([\\w\\-]+\\))?: .+'

COMMITS=$(git log @{u}..HEAD --pretty=format:"%s")

if [ -z "$COMMITS" ]; then
  echo "‚úÖ Nada nuevo que validar"
  exit 0
fi

for COMMIT in $COMMITS; do
  if ! echo "$COMMIT" | grep -qE "$PATTERN"; then
    echo "‚ùå Commit inv√°lido: $COMMIT"
    echo "Los commits deben seguir Conventional Commits"
    exit 1
  fi
done

echo "‚úÖ pre-push aprobado"
