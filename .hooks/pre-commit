#!/bin/bash

echo "üîç Ejecutando pre-commit: limpieza b√°sica..."

# Archivos staged relevantes
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|rb|py|sh|dart|go)$')

if [ -z "$FILES" ]; then
  echo "‚úÖ No hay archivos relevantes para verificar."
  exit 0
fi

FAIL=0

for FILE in $FILES; do
  # Validar espacios al final de l√≠nea
  if grep -q '[[:blank:]]$' "$FILE"; then
    echo "‚ùå Espacios al final de l√≠nea detectados en $FILE"
    FAIL=1
  fi

  # Validar que el archivo termine con salto de l√≠nea
  if [ -n "$(tail -c1 "$FILE")" ]; then
    echo "‚ùå $FILE no termina con salto de l√≠nea"
    FAIL=1
  fi
done

[ $FAIL -eq 0 ] && echo "‚úÖ pre-commit aprobado" || exit 1
